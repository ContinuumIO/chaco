window.export_data = {"95257328": {"width": 65.0, "plots": {"hello": ["95834672"]}, "type": "Plot", "id": "95257328", "height": 35.0}, "95256944": {"value_name": "petalLength", "data_source": 91965488, "index_name": "sepalLength", "color_name": "species", "type": "ColormappedScatterPlot", "id": "95256944"}, "98060528": {"width": 65.0, "plots": {"hello": ["98175024"]}, "type": "Plot", "id": "98060528", "height": 35.0}, "97495088": {"width": 65.0, "plots": {"hello": ["98060144"]}, "type": "Plot", "id": "97495088", "height": 35.0}, "94351824": {"width": 65.0, "plots": {"hello": ["94322512"]}, "type": "Plot", "id": "94351824", "height": 35.0}, "97392208": {"value_name": "sepalWidth", "data_source": 91965488, "index_name": "petalLength", "color_name": "species", "type": "ColormappedScatterPlot", "id": "97392208"}, "94351728": {"width": 420, "shape": [4, 4], "type": "GridPlotContainer", "id": "94351728", "component_grid": [["94351824", "94400880", "95154736", "95257328"], ["95835056", "95933552", "96052432", "96609680"], ["96724560", "97281808", "97392592", "97495088"], ["98060528", "98175408", "98740848", "98843440"]], "height": 420}, "98175024": {"value_name": "sepalLength", "data_source": 91965488, "index_name": "petalWidth", "color_name": "species", "type": "ColormappedScatterPlot", "id": "98175024"}, "96052048": {"value_name": "sepalWidth", "data_source": 91965488, "index_name": "sepalWidth", "color_name": "species", "type": "ColormappedScatterPlot", "id": "96052048"}, "95154736": {"width": 65.0, "plots": {"hello": ["95256944"]}, "type": "Plot", "id": "95154736", "height": 35.0}, "91965488": {"arrays": {"sepalLength": [5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.4, 4.8, 4.8, 4.3, 5.8, 5.7, 5.4, 5.1, 5.7, 5.1, 5.4, 5.1, 4.6, 5.1, 4.8, 5.0, 5.0, 5.2, 5.2, 4.7, 4.8, 5.4, 5.2, 5.5, 4.9, 5.0, 5.5, 4.9, 4.4, 5.1, 5.0, 4.5, 4.4, 5.0, 5.1, 4.8, 5.1, 4.6, 5.3, 5.0, 7.0, 6.4, 6.9, 5.5, 6.5, 5.7, 6.3, 4.9, 6.6, 5.2, 5.0, 5.9, 6.0, 6.1, 5.6, 6.7, 5.6, 5.8, 6.2, 5.6, 5.9, 6.1, 6.3, 6.1, 6.4, 6.6, 6.8, 6.7, 6.0, 5.7, 5.5, 5.5, 5.8, 6.0, 5.4, 6.0, 6.7, 6.3, 5.6, 5.5, 5.5, 6.1, 5.8, 5.0, 5.6, 5.7, 5.7, 6.2, 5.1, 5.7, 6.3, 5.8, 7.1, 6.3, 6.5, 7.6, 4.9, 7.3, 6.7, 7.2, 6.5, 6.4, 6.8, 5.7, 5.8, 6.4, 6.5, 7.7, 7.7, 6.0, 6.9, 5.6, 7.7, 6.3, 6.7, 7.2, 6.2, 6.1, 6.4, 7.2, 7.4, 7.9, 6.4, 6.3, 6.1, 7.7, 6.3, 6.4, 6.0, 6.9, 6.7, 6.9, 5.8, 6.8, 6.7, 6.7, 6.3, 6.5, 6.2, 5.9], "petalWidth": [0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.2, 0.1, 0.1, 0.2, 0.4, 0.4, 0.3, 0.3, 0.3, 0.2, 0.4, 0.2, 0.5, 0.2, 0.2, 0.4, 0.2, 0.2, 0.2, 0.2, 0.4, 0.1, 0.2, 0.2, 0.2, 0.2, 0.1, 0.2, 0.2, 0.3, 0.3, 0.2, 0.6, 0.4, 0.3, 0.2, 0.2, 0.2, 0.2, 1.4, 1.5, 1.5, 1.3, 1.5, 1.3, 1.6, 1.0, 1.3, 1.4, 1.0, 1.5, 1.0, 1.4, 1.3, 1.4, 1.5, 1.0, 1.5, 1.1, 1.8, 1.3, 1.5, 1.2, 1.3, 1.4, 1.4, 1.7, 1.5, 1.0, 1.1, 1.0, 1.2, 1.6, 1.5, 1.6, 1.5, 1.3, 1.3, 1.3, 1.2, 1.4, 1.2, 1.0, 1.3, 1.2, 1.3, 1.3, 1.1, 1.3, 2.5, 1.9, 2.1, 1.8, 2.2, 2.1, 1.7, 1.8, 1.8, 2.5, 2.0, 1.9, 2.1, 2.0, 2.4, 2.3, 1.8, 2.2, 2.3, 1.5, 2.3, 2.0, 2.0, 1.8, 2.1, 1.8, 1.8, 1.8, 2.1, 1.6, 1.9, 2.0, 2.2, 1.5, 1.4, 2.3, 2.4, 1.8, 1.8, 2.1, 2.4, 2.3, 1.9, 2.3, 2.5, 2.3, 1.9, 2.0, 2.3, 1.8], "sepalWidth": [3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.4, 3.0, 3.0, 4.0, 4.4, 3.9, 3.5, 3.8, 3.8, 3.4, 3.7, 3.6, 3.3, 3.4, 3.0, 3.4, 3.5, 3.4, 3.2, 3.1, 3.4, 4.1, 4.2, 3.1, 3.2, 3.5, 3.6, 3.0, 3.4, 3.5, 2.3, 3.2, 3.5, 3.8, 3.0, 3.8, 3.2, 3.7, 3.3, 3.2, 3.2, 3.1, 2.3, 2.8, 2.8, 3.3, 2.4, 2.9, 2.7, 2.0, 3.0, 2.2, 2.9, 2.9, 3.1, 3.0, 2.7, 2.2, 2.5, 3.2, 2.8, 2.5, 2.8, 2.9, 3.0, 2.8, 3.0, 2.9, 2.6, 2.4, 2.4, 2.7, 2.7, 3.0, 3.4, 3.1, 2.3, 3.0, 2.5, 2.6, 3.0, 2.6, 2.3, 2.7, 3.0, 2.9, 2.9, 2.5, 2.8, 3.3, 2.7, 3.0, 2.9, 3.0, 3.0, 2.5, 2.9, 2.5, 3.6, 3.2, 2.7, 3.0, 2.5, 2.8, 3.2, 3.0, 3.8, 2.6, 2.2, 3.2, 2.8, 2.8, 2.7, 3.3, 3.2, 2.8, 3.0, 2.8, 3.0, 2.8, 3.8, 2.8, 2.8, 2.6, 3.0, 3.4, 3.1, 3.0, 3.1, 3.1, 3.1, 2.7, 3.2, 3.3, 3.0, 2.5, 3.0, 3.4, 3.0], "petalLength": [1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.6, 1.4, 1.1, 1.2, 1.5, 1.3, 1.4, 1.7, 1.5, 1.7, 1.5, 1.0, 1.7, 1.9, 1.6, 1.6, 1.5, 1.4, 1.6, 1.6, 1.5, 1.5, 1.4, 1.5, 1.2, 1.3, 1.4, 1.3, 1.5, 1.3, 1.3, 1.3, 1.6, 1.9, 1.4, 1.6, 1.4, 1.5, 1.4, 4.7, 4.5, 4.9, 4.0, 4.6, 4.5, 4.7, 3.3, 4.6, 3.9, 3.5, 4.2, 4.0, 4.7, 3.6, 4.4, 4.5, 4.1, 4.5, 3.9, 4.8, 4.0, 4.9, 4.7, 4.3, 4.4, 4.8, 5.0, 4.5, 3.5, 3.8, 3.7, 3.9, 5.1, 4.5, 4.5, 4.7, 4.4, 4.1, 4.0, 4.4, 4.6, 4.0, 3.3, 4.2, 4.2, 4.2, 4.3, 3.0, 4.1, 6.0, 5.1, 5.9, 5.6, 5.8, 6.6, 4.5, 6.3, 5.8, 6.1, 5.1, 5.3, 5.5, 5.0, 5.1, 5.3, 5.5, 6.7, 6.9, 5.0, 5.7, 4.9, 6.7, 4.9, 5.7, 6.0, 4.8, 4.9, 5.6, 5.8, 6.1, 6.4, 5.6, 5.1, 5.6, 6.1, 5.6, 5.5, 4.8, 5.4, 5.6, 5.1, 5.1, 5.9, 5.7, 5.2, 5.0, 5.2, 5.4, 5.1], "species": [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2]}, "tools": "select", "type": "ArrayPlotData", "id": "91965488"}, "98175408": {"width": 65.0, "plots": {"hello": ["98740464"]}, "type": "Plot", "id": "98175408", "height": 35.0}, "94400880": {"width": 65.0, "plots": {"hello": ["95154352"]}, "type": "Plot", "id": "94400880", "height": 35.0}, "96724560": {"width": 65.0, "plots": {"hello": ["97281424"]}, "type": "Plot", "id": "96724560", "height": 35.0}, "97494704": {"value_name": "petalLength", "data_source": 91965488, "index_name": "petalLength", "color_name": "species", "type": "ColormappedScatterPlot", "id": "97494704"}, "99396112": {"value_name": "petalWidth", "data_source": 91965488, "index_name": "petalWidth", "color_name": "species", "type": "ColormappedScatterPlot", "id": "99396112"}, "98843440": {"width": 65.0, "plots": {"hello": ["99396112"]}, "type": "Plot", "id": "98843440", "height": 35.0}, "97281808": {"width": 65.0, "plots": {"hello": ["97392208"]}, "type": "Plot", "id": "97281808", "height": 35.0}, "98740848": {"width": 65.0, "plots": {"hello": ["98843056"]}, "type": "Plot", "id": "98740848", "height": 35.0}, "95835056": {"width": 65.0, "plots": {"hello": ["95933168"]}, "type": "Plot", "id": "95835056", "height": 35.0}, "98740464": {"value_name": "sepalWidth", "data_source": 91965488, "index_name": "petalWidth", "color_name": "species", "type": "ColormappedScatterPlot", "id": "98740464"}, "96052432": {"width": 65.0, "plots": {"hello": ["96609296"]}, "type": "Plot", "id": "96052432", "height": 35.0}, "95154352": {"value_name": "sepalWidth", "data_source": 91965488, "index_name": "sepalLength", "color_name": "species", "type": "ColormappedScatterPlot", "id": "95154352"}, "96724176": {"value_name": "petalWidth", "data_source": 91965488, "index_name": "sepalWidth", "color_name": "species", "type": "ColormappedScatterPlot", "id": "96724176"}, "98843056": {"value_name": "petalLength", "data_source": 91965488, "index_name": "petalWidth", "color_name": "species", "type": "ColormappedScatterPlot", "id": "98843056"}, "95933168": {"value_name": "sepalLength", "data_source": 91965488, "index_name": "sepalWidth", "color_name": "species", "type": "ColormappedScatterPlot", "id": "95933168"}, "95933552": {"width": 65.0, "plots": {"hello": ["96052048"]}, "type": "Plot", "id": "95933552", "height": 35.0}, "98060144": {"value_name": "petalWidth", "data_source": 91965488, "index_name": "petalLength", "color_name": "species", "type": "ColormappedScatterPlot", "id": "98060144"}, "95834672": {"value_name": "petalWidth", "data_source": 91965488, "index_name": "sepalLength", "color_name": "species", "type": "ColormappedScatterPlot", "id": "95834672"}, "97392592": {"width": 65.0, "plots": {"hello": ["97494704"]}, "type": "Plot", "id": "97392592", "height": 35.0}, "96609296": {"value_name": "petalLength", "data_source": 91965488, "index_name": "sepalWidth", "color_name": "species", "type": "ColormappedScatterPlot", "id": "96609296"}, "96609680": {"width": 65.0, "plots": {"hello": ["96724176"]}, "type": "Plot", "id": "96609680", "height": 35.0}, "97281424": {"value_name": "sepalLength", "data_source": 91965488, "index_name": "petalLength", "color_name": "species", "type": "ColormappedScatterPlot", "id": "97281424"}, "94322512": {"value_name": "sepalLength", "data_source": 91965488, "index_name": "sepalLength", "color_name": "species", "type": "ColormappedScatterPlot", "id": "94322512"}};
window.main_id = "94351728";
_.uniqueId = function (prefix) {
    //from ipython project
    // http://www.ietf.org/rfc/rfc4122.txt
    var s = [];
    var hexDigits = "0123456789ABCDEF";
    for (var i = 0; i < 32; i++) {
        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);
    }
    s[12] = "4";  // bits 12-15 of the time_hi_and_version field to 0010
    s[16] = hexDigits.substr((s[16] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01
    var uuid = s.join("");
    return prefix + "-" + uuid;
};

window.default_render_namespace = {}
chaco = {}
chaco.datasource_from_data = function(namespace, all_objs, obj_id){
    var obj = all_objs[obj_id];
    var obj_type = obj['type']
    var model;
    var collection;
}
chaco.from_data = function(render_namespace, all_objs, obj_id, el){
    var obj = all_objs[obj_id];
    var obj_type = obj['type']
    var model;
    var collection;
    var view;
    if (obj_type ==='GridPlotContainer'){
	if (!render_namespace['GridPlotContainers']){
	    render_namespace['GridPlotContainers'] = new chaco.GridPlotContainers();
	}
	collection = render_namespace['GridPlotContainers'];
	model = collection.create(obj);
	args = {'collection' : collection,
		'model' : model};
	if(el){args['el'] = el}
	view = new chaco.GridPlotContainerView(args);

    }else if (obj_type == 'Plot'){
	obj = _.clone(obj);
	var sub_plot_id = _.values(obj['plots'])[0];
	var sub_obj = _.clone(all_objs[sub_plot_id]);
	if (sub_obj['type'] === 'ColormappedScatterPlot'){
	    _.extend(obj, sub_obj);
	    if (!render_namespace['ColormappedScatterPlots']){
		render_namespace['ColormappedScatterPlots'] = new chaco.ColormappedScatterPlots();
	    }
	    collection = render_namespace['ColormappedScatterPlots'];
	    model = collection.create(obj);
	    args = {'collection' : collection,
		    'model' : model};
	    if(el){args['el'] = el}
	    view = new chaco.ColormappedScatterPlotview(args);
	}
    }
    return {'collection' : collection,
	    'model' : model,
	    'view' : view}
}
//grid plot container model collection view
chaco.GridPlotContainer = Backbone.Model.extend({
    initialize : function(attributes, options){
	if (!attributes['id']){
	    this.set({'id' : _.uniqueId('view')}, 
		     {silent : true})
	}
    },
    defaults : {
	'shape' : [],
	'component_grid' : [[]],
	'height' :  0,
	'width' :  0,
    }
});

chaco.GridPlotContainers = Backbone.Collection.extend({
    model : chaco.GridPlotContainer,
    url : "/",
    localStorage : new Store('GridPlotContainers', true)
});

chaco.GridPlotContainerView = Backbone.View.extend({
    initialize : function(options){
	if (!options['id']){
	    this.id  = _.uniqueId('view');
	}
    },
    render : function(){
	var that = this;
	this.$el = $(this.el);
	this.$el.height(this.model.get('height'));
	this.$el.width(this.model.get('width'));
	_.each(this.model.get('component_grid'), function(row){
	    _.each(row, function(objid){
		results = chaco.from_data(window.default_render_namespace,
					  window.export_data, 
					  objid);
		that.$el.append(results['view'].$el);
	    });
	    that.$el.append($("<br/>"));
	});
    }
});

//color mapped scatter plot model, collection, view
chaco.ColormappedScatterPlot = Backbone.Model.extend({
    initialize : function(attributes, options){
	if (!attributes['id']){
	    this.set({'id' : _.uniqueId('view')}, 
		     {silent : true})
	}
    },
    defaults : {
	'height' :  0,
	'width' :  0,
	'color_name' : '',
	'index_name' : '',
	'value_name' : '',
	'data_source' : null
    },
    render : function(){
	
    }
});
chaco.ColormappedScatterPlots = Backbone.Collection.extend({
    model : chaco.ColormappedScatterPlot,
    url : "/",
    localStorage : new Store('ColormappedScatterPlots', true)
});
chaco.ColormappedScatterPlotview = Backbone.View.extend({
    initialize : function(options){
	if (!options['id']){
	    this.id  = _.uniqueId('view');
	}
    },
});

$(function(){
    results = chaco.from_data(window.default_render_namespace,
			      window.export_data, 
			      window.main_id, 
			      $('#chart')[0]);
    results['view'].render();
});